<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë°˜ë°˜ë§ˆì¼“ â€” ë™ë„¤ ê³µë™êµ¬ë§¤</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Gmarket+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #FF4B35;
    --primary-light: #FF6B55;
    --primary-pale: #FFF0EE;
    --bg: #F5F3EF;
    --card: #FFFFFF;
    --text: #1A1714;
    --text-sub: #6B6561;
    --text-muted: #AAA5A0;
    --border: #E8E4DF;
    --green: #2DBE7A;
    --yellow: #FFB930;
    --blue: #3B82F6;
    --shadow: 0 4px 20px rgba(0,0,0,0.08);
    --shadow-lg: 0 8px 40px rgba(0,0,0,0.12);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'Noto Sans KR',sans-serif; background:var(--bg); color:var(--text); min-height:100vh; overflow-x:hidden; }

  .header { background:var(--card); border-bottom:1px solid var(--border); position:sticky; top:0; z-index:100; padding:0 16px; }
  .header-inner { max-width:480px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; height:56px; }
  .logo { font-family:'Gmarket Sans',sans-serif; font-weight:700; font-size:20px; color:var(--primary); letter-spacing:-0.5px; }
  .logo span { color:var(--text); }
  .header-icons { display:flex; gap:16px; }
  .icon-btn { background:none; border:none; cursor:pointer; font-size:20px; color:var(--text-sub); position:relative; }
  .badge { position:absolute; top:-4px; right:-6px; background:var(--primary); color:white; font-size:9px; font-weight:700; width:16px; height:16px; border-radius:50%; display:flex; align-items:center; justify-content:center; }

  .location-bar { background:var(--card); padding:10px 16px; border-bottom:1px solid var(--border); }
  .location-bar-inner { max-width:480px; margin:0 auto; display:flex; align-items:center; gap:6px; }
  .loc-text { font-weight:700; font-size:14px; cursor:pointer; }
  .loc-notice { margin-left:auto; background:var(--primary-pale); color:var(--primary); font-size:11px; font-weight:700; padding:3px 8px; border-radius:20px; }

  .page { display:none; max-width:480px; margin:0 auto; padding:16px; padding-bottom:110px; }
  .page.active { display:block; }

  .score-card { background:linear-gradient(135deg,var(--primary) 0%,#FF6B35 100%); border-radius:16px; padding:16px 20px; color:white; margin-bottom:16px; display:flex; align-items:center; justify-content:space-between; box-shadow:0 6px 24px rgba(255,75,53,0.3); cursor:pointer; transition:transform 0.15s; }
  .score-card:hover { transform:translateY(-2px); }
  .score-bar-bg { background:rgba(255,255,255,0.25); height:6px; border-radius:3px; margin-top:10px; }
  .score-bar-fill { background:white; height:6px; border-radius:3px; width:87%; }
  .score-bar-text { display:flex; justify-content:space-between; font-size:10px; opacity:0.8; margin-top:4px; }
  .score-num { font-family:'Gmarket Sans',sans-serif; font-size:36px; font-weight:700; line-height:1; }

  .section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; margin-top:20px; }
  .section-title { font-family:'Gmarket Sans',sans-serif; font-weight:700; font-size:16px; }
  .section-more { color:var(--text-muted); font-size:12px; cursor:pointer; background:none; border:none; }

  .cats { display:flex; gap:8px; overflow-x:auto; padding-bottom:4px; margin-bottom:16px; scrollbar-width:none; }
  .cats::-webkit-scrollbar { display:none; }
  .cat-btn { background:var(--card); border:1.5px solid var(--border); border-radius:20px; padding:6px 14px; font-size:13px; font-weight:500; cursor:pointer; white-space:nowrap; transition:all 0.15s; color:var(--text-sub); display:flex; align-items:center; gap:4px; font-family:'Noto Sans KR',sans-serif; }
  .cat-btn.active { background:var(--primary); border-color:var(--primary); color:white; font-weight:700; }

  .room-card { background:var(--card); border-radius:16px; padding:16px; margin-bottom:12px; box-shadow:var(--shadow); cursor:pointer; transition:all 0.18s; border:1.5px solid transparent; }
  .room-card:hover { transform:translateY(-2px); box-shadow:var(--shadow-lg); border-color:var(--primary-pale); }
  .room-top { display:flex; gap:12px; margin-bottom:12px; }
  .room-img { width:70px; height:70px; border-radius:12px; background:var(--bg); display:flex; align-items:center; justify-content:center; font-size:32px; flex-shrink:0; }
  .room-info { flex:1; }
  .room-cat { font-size:11px; color:var(--primary); font-weight:700; margin-bottom:3px; }
  .room-name { font-size:15px; font-weight:700; line-height:1.3; margin-bottom:4px; }
  .room-host { font-size:12px; color:var(--text-muted); display:flex; align-items:center; gap:4px; }
  .host-score { background:var(--primary-pale); color:var(--primary); font-size:10px; font-weight:700; padding:1px 6px; border-radius:4px; }
  .room-price { font-size:14px; font-weight:700; color:var(--primary); margin-top:2px; }
  .room-price span { font-size:11px; color:var(--text-muted); font-weight:400; }
  .progress-area { margin-bottom:10px; }
  .progress-top { display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px; }
  .prog-label { color:var(--text-sub); }
  .prog-count { font-weight:700; }
  .prog-count.full { color:var(--green); }
  .progress-bg { background:var(--bg); height:8px; border-radius:4px; overflow:hidden; }
  .progress-fill { height:100%; border-radius:4px; background:linear-gradient(90deg,var(--primary),var(--primary-light)); transition:width 0.6s ease; }
  .progress-fill.full { background:linear-gradient(90deg,var(--green),#5DE3A0); }
  .room-bottom { display:flex; align-items:center; justify-content:space-between; }
  .room-tags { display:flex; gap:6px; flex-wrap:wrap; }
  .tag { font-size:11px; padding:3px 8px; border-radius:6px; font-weight:500; }
  .tag-loc { background:#EEF2FF; color:var(--blue); }
  .tag-time { background:#FFF8E7; color:var(--yellow); }
  .join-btn { background:var(--primary); color:white; border:none; border-radius:10px; padding:8px 16px; font-size:13px; font-weight:700; cursor:pointer; transition:all 0.15s; font-family:'Noto Sans KR',sans-serif; white-space:nowrap; }
  .join-btn:hover { background:#e63e27; }
  .join-btn.joined { background:var(--bg); color:var(--text-muted); border:1.5px solid var(--border); }
  .join-btn.full-btn { background:var(--text-muted); cursor:default; }

  .fab { position:fixed; bottom:80px; right:calc(50% - 240px + 16px); background:var(--primary); color:white; border:none; border-radius:50px; padding:14px 22px; font-size:15px; font-weight:700; cursor:pointer; box-shadow:0 6px 24px rgba(255,75,53,0.4); display:flex; align-items:center; gap:8px; transition:all 0.2s; font-family:'Noto Sans KR',sans-serif; z-index:50; }
  .fab:hover { transform:translateY(-3px); }
  .fab.hidden { display:none; }

  .bottom-nav { position:fixed; bottom:0; left:0; right:0; background:var(--card); border-top:1px solid var(--border); z-index:100; }
  .bottom-nav-inner { max-width:480px; margin:0 auto; display:flex; }
  .nav-item { flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:10px 0 14px; cursor:pointer; color:var(--text-muted); font-size:10px; font-weight:500; transition:color 0.15s; border:none; background:none; font-family:'Noto Sans KR',sans-serif; }
  .nav-item.active { color:var(--primary); }
  .nav-icon { font-size:20px; margin-bottom:3px; }

  .modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:200; display:none; align-items:flex-end; justify-content:center; backdrop-filter:blur(2px); }
  .modal-overlay.open { display:flex; animation:fadeIn 0.2s ease; }
  @keyframes fadeIn { from{opacity:0}to{opacity:1} }
  .modal { background:var(--card); border-radius:24px 24px 0 0; padding:24px 20px 40px; width:100%; max-width:480px; animation:slideUp 0.3s ease; max-height:85vh; overflow-y:auto; }
  @keyframes slideUp { from{transform:translateY(100%)}to{transform:translateY(0)} }
  .modal-handle { width:40px; height:4px; background:var(--border); border-radius:2px; margin:0 auto 20px; }
  .modal-title { font-family:'Gmarket Sans',sans-serif; font-size:20px; font-weight:700; margin-bottom:20px; }

  .form-group { margin-bottom:16px; }
  .form-label { font-size:13px; font-weight:700; color:var(--text-sub); margin-bottom:6px; display:block; }
  .form-input,.form-select { width:100%; border:1.5px solid var(--border); border-radius:10px; padding:12px 14px; font-size:14px; font-family:'Noto Sans KR',sans-serif; outline:none; transition:border-color 0.15s; background:var(--card); }
  .form-input:focus,.form-select:focus { border-color:var(--primary); }
  .form-row { display:flex; gap:10px; }
  .form-row .form-group { flex:1; }
  .place-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:6px; }
  .place-opt { border:1.5px solid var(--border); border-radius:10px; padding:10px 12px; cursor:pointer; transition:all 0.15s; display:flex; align-items:center; gap:8px; font-size:13px; }
  .place-opt.selected { border-color:var(--primary); background:var(--primary-pale); color:var(--primary); font-weight:700; }
  .submit-btn { width:100%; background:var(--primary); color:white; border:none; border-radius:12px; padding:16px; font-size:16px; font-weight:700; cursor:pointer; margin-top:8px; font-family:'Noto Sans KR',sans-serif; transition:all 0.15s; }
  .submit-btn:hover { background:#e63e27; }
  .cancel-btn { width:100%; background:none; border:none; padding:12px; color:var(--text-muted); cursor:pointer; font-size:14px; font-family:'Noto Sans KR',sans-serif; }

  /* ì±„íŒ… */
  .chat-header { display:flex; align-items:center; gap:10px; background:var(--bg); border-radius:12px; padding:10px 12px; margin-bottom:16px; }
  .chat-room-info { flex:1; }
  .chat-room-name { font-size:13px; font-weight:700; }
  .chat-room-sub { font-size:11px; color:var(--text-muted); }
  .chat-messages { display:flex; flex-direction:column; gap:10px; margin-bottom:16px; max-height:280px; overflow-y:auto; padding:4px 0; }
  .chat-msg { display:flex; gap:8px; align-items:flex-end; }
  .chat-msg.me { flex-direction:row-reverse; }
  .chat-avatar { width:32px; height:32px; border-radius:10px; background:var(--bg); display:flex; align-items:center; justify-content:center; font-size:16px; flex-shrink:0; }
  .chat-bubble-wrap { display:flex; flex-direction:column; gap:2px; max-width:70%; }
  .chat-msg.me .chat-bubble-wrap { align-items:flex-end; }
  .chat-nick { font-size:11px; color:var(--text-muted); margin-bottom:2px; }
  .chat-bubble { background:var(--bg); padding:8px 12px; border-radius:12px 12px 12px 4px; font-size:13px; line-height:1.5; }
  .chat-msg.me .chat-bubble { background:var(--primary); color:white; border-radius:12px 12px 4px 12px; }
  .chat-time { font-size:10px; color:var(--text-muted); }
  .chat-input-row { display:flex; gap:8px; }
  .chat-input { flex:1; border:1.5px solid var(--border); border-radius:10px; padding:10px 14px; font-size:14px; font-family:'Noto Sans KR',sans-serif; outline:none; }
  .chat-input:focus { border-color:var(--primary); }
  .chat-send-btn { background:var(--primary); color:white; border:none; border-radius:10px; padding:10px 16px; font-size:16px; cursor:pointer; }

  /* ì°¸ì—¬ì ëª©ë¡ */
  .participant-row { display:flex; align-items:center; gap:12px; padding:12px 0; border-bottom:1px solid var(--border); }
  .participant-row:last-child { border-bottom:none; }
  .participant-avatar { width:40px; height:40px; background:var(--bg); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; }
  .participant-info { flex:1; }
  .participant-nick { font-size:14px; font-weight:700; }
  .participant-detail { font-size:12px; color:var(--text-muted); margin-top:2px; }
  .p-score-big { background:var(--primary-pale); color:var(--primary); font-size:12px; font-weight:700; padding:3px 10px; border-radius:20px; }
  .check-status { font-size:13px; font-weight:700; }
  .check-done { color:var(--green); }
  .check-wait { color:var(--text-muted); }

  /* ìˆ˜ë ¹ ì²´í¬ */
  .check-row { display:flex; align-items:center; gap:12px; padding:12px; background:var(--bg); border-radius:12px; margin-bottom:8px; transition:all 0.2s; }
  .check-row.checked { background:#F0FDF4; }
  .check-box { width:28px; height:28px; border-radius:8px; border:2px solid var(--border); display:flex; align-items:center; justify-content:center; cursor:pointer; transition:all 0.2s; flex-shrink:0; font-size:14px; }
  .check-row.checked .check-box { background:var(--green); border-color:var(--green); color:white; }
  .check-info { flex:1; }
  .check-name { font-size:14px; font-weight:700; }
  .check-qty { font-size:12px; color:var(--text-muted); margin-top:2px; }
  .check-summary { background:var(--bg); border-radius:10px; padding:12px; margin:12px 0; text-align:center; font-size:14px; }
  .check-summary b { color:var(--primary); font-size:18px; }

  .detail-hero { font-size:60px; text-align:center; padding:10px 0 16px; }
  .detail-title { font-size:18px; font-weight:700; margin-bottom:12px; }
  .detail-section { margin-bottom:16px; }
  .detail-sec-title { font-size:12px; font-weight:700; color:var(--text-muted); margin-bottom:8px; text-transform:uppercase; letter-spacing:0.5px; }
  .detail-info-row { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid var(--border); font-size:14px; }
  .detail-info-row:last-child { border-bottom:none; }
  .detail-info-label { color:var(--text-sub); }
  .detail-info-val { font-weight:700; }
  .participants-list { display:flex; flex-wrap:wrap; gap:8px; }
  .participant-chip { background:var(--bg); border-radius:20px; padding:4px 12px; font-size:13px; display:flex; align-items:center; gap:4px; }
  .p-score { font-size:10px; color:var(--primary); font-weight:700; }
  .rule-list { display:flex; flex-direction:column; gap:8px; }
  .rule-item { background:var(--bg); border-radius:10px; padding:10px 12px; font-size:13px; display:flex; align-items:flex-start; gap:8px; }

  /* íƒìƒ‰ */
  .search-box { display:flex; align-items:center; background:var(--card); border:1.5px solid var(--border); border-radius:12px; padding:10px 14px; gap:10px; margin-bottom:16px; }
  .search-box input { flex:1; border:none; outline:none; font-size:14px; font-family:'Noto Sans KR',sans-serif; background:transparent; }
  .trend-tags { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:20px; }
  .trend-tag { background:var(--card); border:1.5px solid var(--border); border-radius:20px; padding:6px 14px; font-size:13px; cursor:pointer; transition:all 0.15s; }
  .trend-tag:hover { border-color:var(--primary); color:var(--primary); }
  .map-placeholder { background:var(--card); border-radius:16px; height:160px; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; color:var(--text-muted); font-size:14px; border:2px dashed var(--border); margin-bottom:16px; }
  .nearby-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
  .nearby-count { background:var(--primary-pale); color:var(--primary); font-size:12px; font-weight:700; padding:2px 10px; border-radius:20px; }
  .nearby-room { display:flex; align-items:center; gap:12px; background:var(--card); border-radius:12px; padding:12px; margin-bottom:8px; cursor:pointer; box-shadow:var(--shadow); transition:all 0.15s; }
  .nearby-room:hover { transform:translateX(4px); }
  .nearby-emoji { font-size:28px; width:48px; height:48px; background:var(--bg); border-radius:10px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
  .nearby-name { font-size:13px; font-weight:700; margin-bottom:2px; }
  .nearby-sub { font-size:11px; color:var(--text-muted); }
  .nearby-dist { font-size:12px; font-weight:700; color:var(--blue); }

  /* ë‚´ ê±°ë˜ */
  .trade-tabs { display:flex; background:var(--bg); border-radius:12px; padding:4px; margin-bottom:16px; }
  .trade-tab { flex:1; padding:8px; text-align:center; font-size:13px; font-weight:700; cursor:pointer; border-radius:8px; transition:all 0.2s; color:var(--text-muted); border:none; background:none; font-family:'Noto Sans KR',sans-serif; }
  .trade-tab.active { background:var(--card); color:var(--primary); box-shadow:0 2px 8px rgba(0,0,0,0.08); }
  .trade-card { background:var(--card); border-radius:16px; padding:16px; margin-bottom:12px; box-shadow:var(--shadow); }
  .trade-top { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
  .trade-emoji { font-size:28px; width:50px; height:50px; background:var(--bg); border-radius:10px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
  .trade-info { flex:1; }
  .trade-name { font-size:14px; font-weight:700; margin-bottom:2px; }
  .trade-sub { font-size:12px; color:var(--text-muted); }
  .status-badge { font-size:11px; font-weight:700; padding:3px 10px; border-radius:20px; white-space:nowrap; }
  .status-active { background:#EFF6FF; color:var(--blue); }
  .status-done { background:#F0FDF4; color:var(--green); }
  .status-wait { background:#FFF8E7; color:var(--yellow); }
  .trade-actions { display:flex; gap:8px; }
  .trade-btn { flex:1; padding:9px; border-radius:10px; font-size:13px; font-weight:700; cursor:pointer; border:none; font-family:'Noto Sans KR',sans-serif; transition:all 0.15s; }
  .trade-btn-primary { background:var(--primary); color:white; }
  .trade-btn-primary:hover { background:#e63e27; }
  .trade-btn-secondary { background:var(--bg); color:var(--text-sub); border:1.5px solid var(--border); }
  .trade-btn-secondary:hover { border-color:var(--primary); color:var(--primary); }
  .review-prompt { background:linear-gradient(135deg,#FFF8E7,#FFFBF0); border:1.5px solid var(--yellow); border-radius:12px; padding:12px; margin-bottom:12px; display:flex; align-items:center; gap:10px; }
  .review-text { flex:1; font-size:13px; font-weight:500; }
  .review-text b { color:#d4900a; }
  .review-btn { background:var(--yellow); color:white; border:none; border-radius:8px; padding:7px 12px; font-size:12px; font-weight:700; cursor:pointer; font-family:'Noto Sans KR',sans-serif; white-space:nowrap; }
  .history-card { background:var(--card); border-radius:16px; padding:16px; margin-bottom:12px; box-shadow:var(--shadow); }
  .history-item { display:flex; align-items:center; gap:12px; }
  .history-info { flex:1; }
  .history-name { font-size:14px; font-weight:700; margin-bottom:2px; }
  .history-date { font-size:12px; color:var(--text-muted); margin-bottom:4px; }
  .history-stars { color:var(--yellow); font-size:13px; }
  .history-review { font-size:12px; color:var(--text-sub); margin-top:4px; font-style:italic; }

  /* ë§ˆì´ */
  .my-profile-card { background:var(--card); border-radius:20px; padding:20px; margin-bottom:16px; box-shadow:var(--shadow); }
  .my-avatar { width:64px; height:64px; background:linear-gradient(135deg,var(--primary),#FF8C69); border-radius:20px; display:flex; align-items:center; justify-content:center; font-size:32px; margin-bottom:12px; }
  .my-nick { font-size:20px; font-weight:900; margin-bottom:4px; }
  .my-sub { font-size:13px; color:var(--text-muted); margin-bottom:16px; }
  .my-stats { display:flex; background:var(--bg); border-radius:12px; overflow:hidden; }
  .my-stat { flex:1; padding:12px 8px; text-align:center; border-right:1px solid var(--border); }
  .my-stat:last-child { border-right:none; }
  .my-stat-num { font-family:'Gmarket Sans',sans-serif; font-size:22px; font-weight:700; color:var(--primary); }
  .my-stat-label { font-size:11px; color:var(--text-muted); margin-top:2px; }
  .my-score-section { background:var(--card); border-radius:16px; padding:16px; margin-bottom:16px; box-shadow:var(--shadow); }
  .score-progress-bg { background:var(--bg); height:10px; border-radius:5px; margin-bottom:6px; overflow:hidden; }
  .score-progress-fill { height:100%; background:linear-gradient(90deg,var(--primary),#FF8C69); border-radius:5px; width:87%; }
  .score-milestones { display:flex; justify-content:space-between; font-size:11px; color:var(--text-muted); }
  .score-hist-item { display:flex; justify-content:space-between; align-items:center; font-size:13px; padding:8px 0; border-bottom:1px solid var(--border); }
  .score-hist-item:last-child { border-bottom:none; }
  .score-up { color:var(--green); font-weight:700; }
  .score-down { color:var(--primary); font-weight:700; }
  .menu-section { background:var(--card); border-radius:16px; margin-bottom:12px; box-shadow:var(--shadow); overflow:hidden; }
  .menu-section-title { font-size:11px; font-weight:700; color:var(--text-muted); padding:12px 16px 6px; text-transform:uppercase; letter-spacing:0.5px; }
  .menu-item { display:flex; align-items:center; gap:12px; padding:14px 16px; cursor:pointer; transition:background 0.15s; border-bottom:1px solid var(--border); }
  .menu-item:last-child { border-bottom:none; }
  .menu-item:hover { background:var(--bg); }
  .menu-icon { font-size:20px; }
  .menu-label { flex:1; font-size:14px; font-weight:500; }
  .menu-badge { background:var(--primary); color:white; font-size:10px; font-weight:700; padding:2px 8px; border-radius:20px; }

  /* í›„ê¸° ëª¨ë‹¬ */
  .star-row { display:flex; gap:8px; margin-bottom:16px; }
  .star-btn { font-size:32px; cursor:pointer; border:none; background:none; opacity:0.3; transition:all 0.1s; }
  .star-btn.on { opacity:1; transform:scale(1.1); }

  .toast { position:fixed; top:70px; left:50%; transform:translateX(-50%); background:var(--text); color:white; padding:12px 20px; border-radius:12px; font-size:14px; font-weight:500; z-index:999; white-space:nowrap; opacity:0; transition:opacity 0.3s; pointer-events:none; }
  .toast.show { opacity:1; }

  .empty-state { text-align:center; padding:48px 20px; color:var(--text-muted); }
  .empty-icon { font-size:48px; margin-bottom:12px; }
  .empty-text { font-size:15px; font-weight:700; margin-bottom:6px; color:var(--text-sub); }
  .empty-sub { font-size:13px; }
</style>
</head>
<body>

<header class="header">
  <div class="header-inner">
    <div class="logo">ë°˜ë°˜<span>ë§ˆì¼“</span></div>
    <div class="header-icons">
      <button class="icon-btn" onclick="showToast('ìƒˆ ì•Œë¦¼ 2ê°œ')">ğŸ””<span class="badge">2</span></button>
      <button class="icon-btn" onclick="showToast('ì±„íŒ… ê¸°ëŠ¥ ì¤€ë¹„ì¤‘')">ğŸ’¬</button>
    </div>
  </div>
</header>

<div class="location-bar">
  <div class="location-bar-inner">
    <span style="color:var(--primary)">ğŸ“</span>
    <span class="loc-text">ì„œìš¸ ë§ˆí¬êµ¬ í•©ì •ë™</span>
    <span style="color:var(--text-muted);font-size:12px">â–¾</span>
    <span class="loc-notice" id="locationNotice">ì§€ê¸ˆ 3ê°œ ì§„í–‰ì¤‘</span>
  </div>
</div>

<!-- í™ˆ -->
<div class="page active" id="page-home">
  <div class="score-card" onclick="goNav('my')">
    <div style="flex:1">
      <div style="font-size:12px;opacity:0.85">ë‚´ ì‹ ë¢° ì ìˆ˜ Â· íƒ­í•´ì„œ ìì„¸íˆ ë³´ê¸°</div>
      <div style="font-size:16px;font-weight:700;margin:4px 0">ë‹¹ê·¼ìœ ì €_ë§ˆí¬ ğŸ¥•</div>
      <div class="score-bar-bg"><div class="score-bar-fill"></div></div>
      <div class="score-bar-text"><span>ë°©ì¥ ê¸°ì¤€ 80ì </span><span>87/100</span></div>
    </div>
    <div style="margin-left:16px;text-align:center">
      <div class="score-num">87</div>
      <div style="font-size:11px;opacity:0.8;line-height:1.6;margin-top:2px">ê±°ë˜ 12íšŒ<br>í›„ê¸° 100%</div>
    </div>
  </div>

  <div class="cats" id="catTabs">
    <button class="cat-btn active" onclick="filterCat(this,'ì „ì²´')">ğŸ  ì „ì²´</button>
    <button class="cat-btn" onclick="filterCat(this,'ì‹í’ˆ')">ğŸ¥© ì‹í’ˆ</button>
    <button class="cat-btn" onclick="filterCat(this,'ìƒí™œ')">ğŸ§´ ìƒí™œìš©í’ˆ</button>
    <button class="cat-btn" onclick="filterCat(this,'ìœ¡ì•„')">ğŸ¼ ìœ¡ì•„</button>
    <button class="cat-btn" onclick="filterCat(this,'ë°˜ë ¤')">ğŸ¾ ë°˜ë ¤ë™ë¬¼</button>
    <button class="cat-btn" onclick="filterCat(this,'ê¸°íƒ€')">ğŸ“¦ ê¸°íƒ€</button>
  </div>

  <div class="section-header">
    <div class="section-title">ğŸ”¥ ì§€ê¸ˆ ëª¨ì§‘ì¤‘</div>
    <button class="section-more" onclick="goNav('search')">ë”ë³´ê¸° â†’</button>
  </div>
  <div id="roomList"></div>
</div>

<!-- íƒìƒ‰ -->
<div class="page" id="page-search">
  <div class="search-box">
    <span>ğŸ”</span>
    <input type="text" placeholder="ìƒí’ˆëª…, ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰..." oninput="doSearch(this.value)" id="searchInput">
  </div>
  <div style="font-size:13px;font-weight:700;margin-bottom:8px">ğŸ”¥ ì¸ê¸° ê²€ìƒ‰ì–´</div>
  <div class="trend-tags">
    <span class="trend-tag" onclick="searchKw('ì½”ìŠ¤íŠ¸ì½”')">ğŸ›’ ì½”ìŠ¤íŠ¸ì½”</span>
    <span class="trend-tag" onclick="searchKw('ê¸°ì €ê·€')">ğŸ¼ ê¸°ì €ê·€</span>
    <span class="trend-tag" onclick="searchKw('ì‚¬ë£Œ')">ğŸ¾ ì‚¬ë£Œ</span>
    <span class="trend-tag" onclick="searchKw('LAê°ˆë¹„')">ğŸ¥© LAê°ˆë¹„</span>
    <span class="trend-tag" onclick="searchKw('ì„¸ì œ')">ğŸ§´ ì„¸ì œ</span>
    <span class="trend-tag" onclick="searchKw('ë¶„ìœ ')">ğŸ¶ ë¶„ìœ </span>
  </div>
  <div class="map-placeholder">
    <div style="font-size:36px">ğŸ—ºï¸</div>
    <div style="font-weight:700">ì§€ë„ì—ì„œ ê·¼ì²˜ ë°© ë³´ê¸°</div>
    <div style="font-size:12px">ì‹¤ì„œë¹„ìŠ¤ì—ì„œ ì¹´ì¹´ì˜¤ë§µ ì—°ë™ ì˜ˆì •</div>
  </div>
  <div class="nearby-header">
    <div style="font-weight:700;font-size:14px">ğŸ“ ë‚´ ê·¼ì²˜ ê³µë™êµ¬ë§¤</div>
    <div class="nearby-count" id="nearbyCount">4ê°œ</div>
  </div>
  <div id="searchResults"></div>
</div>

<!-- ë‚´ ê±°ë˜ -->
<div class="page" id="page-trade">
  <div class="trade-tabs">
    <button class="trade-tab active" id="ttab-join" onclick="switchTradeTab('join')">ì°¸ì—¬ì¤‘</button>
    <button class="trade-tab" id="ttab-host" onclick="switchTradeTab('host')">ë°©ì¥</button>
    <button class="trade-tab" id="ttab-done" onclick="switchTradeTab('done')">ì™„ë£Œ</button>
  </div>
  <div class="review-prompt" id="reviewPrompt" style="display:none">
    <span style="font-size:24px">âš ï¸</span>
    <div class="review-text"><b>í›„ê¸° ì‘ì„± í•„ìˆ˜!</b><br>ì™„ë£Œëœ ê±°ë˜ì˜ í›„ê¸°ë¥¼ ë¨¼ì € ì‘ì„±í•´ì•¼<br>ì„œë¹„ìŠ¤ë¥¼ ê³„ì† ì´ìš©í•  ìˆ˜ ìˆì–´ìš”.</div>
    <button class="review-btn" onclick="openReviewModal()">ì‘ì„±í•˜ê¸°</button>
  </div>
  <div id="tradeContent"></div>
</div>

<!-- ë§ˆì´ -->
<div class="page" id="page-my">
  <div class="my-profile-card">
    <div class="my-avatar">ğŸ¥•</div>
    <div class="my-nick">ë‹¹ê·¼ìœ ì €_ë§ˆí¬</div>
    <div class="my-sub">ì„œìš¸ ë§ˆí¬êµ¬ í•©ì •ë™ Â· ê°€ì… 2024.03</div>
    <div class="my-stats">
      <div class="my-stat"><div class="my-stat-num">12</div><div class="my-stat-label">ì´ ê±°ë˜</div></div>
      <div class="my-stat"><div class="my-stat-num">3</div><div class="my-stat-label">ë°©ì¥ ê²½í—˜</div></div>
      <div class="my-stat"><div class="my-stat-num">100%</div><div class="my-stat-label">í›„ê¸° ì™„ë£Œìœ¨</div></div>
      <div class="my-stat"><div class="my-stat-num">0</div><div class="my-stat-label">ë…¸ì‡¼ íšŸìˆ˜</div></div>
    </div>
  </div>

  <div class="my-score-section">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div style="font-weight:700;font-size:15px">ğŸ† ì‹ ë¢° ì ìˆ˜</div>
      <div style="font-family:'Gmarket Sans',sans-serif;font-size:28px;font-weight:700;color:var(--primary)">87ì </div>
    </div>
    <div class="score-progress-bg"><div class="score-progress-fill"></div></div>
    <div class="score-milestones" style="margin-bottom:14px">
      <span>0</span>
      <span style="color:var(--primary);font-weight:700">âœ“ ë°©ì¥ ê°€ëŠ¥ (80)</span>
      <span style="font-weight:700;color:#a855f7">VIP (95)</span>
      <span>100</span>
    </div>
    <div style="font-size:12px;font-weight:700;color:var(--text-muted);margin-bottom:8px">ìµœê·¼ ì ìˆ˜ ë³€ë™</div>
    <div class="score-hist-item"><span>ğŸ¥© LAê°ˆë¹„ ê±°ë˜ ì™„ë£Œ + í›„ê¸°</span><span class="score-up">+3ì </span></div>
    <div class="score-hist-item"><span>ğŸ¼ ê¸°ì €ê·€ ê±°ë˜ ì™„ë£Œ + í›„ê¸°</span><span class="score-up">+3ì </span></div>
    <div class="score-hist-item"><span>ğŸ§´ ì„¸ì œ ë°©ì¥ ì™„ë£Œ</span><span class="score-up">+5ì </span></div>
    <div class="score-hist-item"><span>âš ï¸ 1íšŒ ì§€ê° (ì°¸ì—¬ì ì‹ ê³ )</span><span class="score-down">-2ì </span></div>
  </div>

  <div class="menu-section">
    <div class="menu-section-title">ë‚´ ê³„ì •</div>
    <div class="menu-item" onclick="showToast('í”„ë¡œí•„ ìˆ˜ì • í˜ì´ì§€')"><span class="menu-icon">âœï¸</span><span class="menu-label">í”„ë¡œí•„ ìˆ˜ì •</span><span style="color:var(--text-muted)">â€º</span></div>
    <div class="menu-item" onclick="showToast('âœ… ë™ë„¤ ì¸ì¦ ì™„ë£Œ ìƒíƒœ')"><span class="menu-icon">ğŸ“</span><span class="menu-label">ë™ë„¤ ì¸ì¦</span><span class="menu-badge" style="background:var(--green)">ì™„ë£Œ</span></div>
    <div class="menu-item" onclick="showToast('ì•Œë¦¼ ì„¤ì •')"><span class="menu-icon">ğŸ””</span><span class="menu-label">ì•Œë¦¼ ì„¤ì •</span><span style="color:var(--text-muted)">â€º</span></div>
  </div>

  <div class="menu-section">
    <div class="menu-section-title">ê³ ê°ì§€ì›</div>
    <div class="menu-item" onclick="showToast('ê³µì§€ì‚¬í•­')"><span class="menu-icon">ğŸ“¢</span><span class="menu-label">ê³µì§€ì‚¬í•­</span><span class="menu-badge" style="background:var(--blue)">2</span></div>
    <div class="menu-item" onclick="showToast('ì´ìš© ê°€ì´ë“œ')"><span class="menu-icon">ğŸ“–</span><span class="menu-label">ì´ìš© ê°€ì´ë“œ</span><span style="color:var(--text-muted)">â€º</span></div>
    <div class="menu-item" onclick="showToast('ì‹ ê³ /ì´ì˜ì œê¸°')"><span class="menu-icon">ğŸš¨</span><span class="menu-label">ì‹ ê³  / ì´ì˜ì œê¸°</span><span style="color:var(--text-muted)">â€º</span></div>
    <div class="menu-item" onclick="showToast('1:1 ê³ ê°ì„¼í„°')"><span class="menu-icon">ğŸ’¬</span><span class="menu-label">ê³ ê°ì„¼í„°</span><span style="color:var(--text-muted)">â€º</span></div>
  </div>

  <div style="text-align:center;padding:20px;color:var(--text-muted);font-size:12px">
    ë°˜ë°˜ë§ˆì¼“ v0.1 MVP Â· â“’ 2025<br>
    <span style="color:var(--primary);cursor:pointer;font-weight:700" onclick="showToast('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤')">ë¡œê·¸ì•„ì›ƒ</span>
  </div>
</div>

<!-- FAB -->
<button class="fab" id="fabBtn" onclick="openCreate()">ï¼‹ ë°© ë§Œë“¤ê¸°</button>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <div class="bottom-nav-inner">
    <button class="nav-item active" id="nav-home" onclick="goNav('home')"><div class="nav-icon">ğŸ </div>í™ˆ</button>
    <button class="nav-item" id="nav-search" onclick="goNav('search')"><div class="nav-icon">ğŸ”</div>íƒìƒ‰</button>
    <button class="nav-item" id="nav-trade" onclick="goNav('trade')"><div class="nav-icon">ğŸ“‹</div>ë‚´ ê±°ë˜</button>
    <button class="nav-item" id="nav-my" onclick="goNav('my')"><div class="nav-icon">ğŸ‘¤</div>ë§ˆì´</button>
  </div>
</nav>

<!-- CREATE MODAL -->
<div class="modal-overlay" id="createModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">ë°© ë§Œë“¤ê¸°</div>
    <div class="form-group">
      <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
      <select class="form-select" id="newCat"><option value="ì‹í’ˆ">ğŸ¥© ì‹í’ˆ</option><option value="ìƒí™œ">ğŸ§´ ìƒí™œìš©í’ˆ</option><option value="ìœ¡ì•„">ğŸ¼ ìœ¡ì•„</option><option value="ë°˜ë ¤">ğŸ¾ ë°˜ë ¤ë™ë¬¼</option><option value="ê¸°íƒ€">ğŸ“¦ ê¸°íƒ€</option></select>
    </div>
    <div class="form-group">
      <label class="form-label">ìƒí’ˆëª…</label>
      <input class="form-input" type="text" id="newName" placeholder="ì˜ˆ) ì½”ìŠ¤íŠ¸ì½” ì†Œê³ ê¸° 1+ë“±ê¸‰ LAê°ˆë¹„ 5kg">
    </div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">ì´ ìˆ˜ëŸ‰</label><input class="form-input" type="text" id="newTotal" placeholder="5kg"></div>
      <div class="form-group"><label class="form-label">ì´ ê°€ê²© (ì›)</label><input class="form-input" type="number" id="newPrice" placeholder="65000"></div>
    </div>
    <div class="form-group">
      <label class="form-label">ë§ˆê° ì‹œê°„</label>
      <input class="form-input" type="datetime-local" id="newDeadline">
    </div>
    <div class="form-group">
      <label class="form-label">ğŸ“ ê±°ë˜ ì¥ì†Œ (ì§€ì • ì¥ì†Œë§Œ ì„ íƒ ê°€ëŠ¥)</label>
      <div class="place-grid">
        <div class="place-opt" onclick="selectPlace(this)"><span style="font-size:18px">ğŸª</span>í™ˆí”ŒëŸ¬ìŠ¤ í•©ì •ì  ì•</div>
        <div class="place-opt" onclick="selectPlace(this)"><span style="font-size:18px">ğŸš‡</span>í•©ì •ì—­ 2ë²ˆ ì¶œêµ¬</div>
        <div class="place-opt" onclick="selectPlace(this)"><span style="font-size:18px">ğŸ›</span>í•©ì •ë™ ì£¼ë¯¼ì„¼í„°</div>
        <div class="place-opt" onclick="selectPlace(this)"><span style="font-size:18px">ğŸŒ³</span>í•©ì • ì–´ìš¸ë§ˆë‹¹ ê³µì›</div>
      </div>
    </div>
    <button class="submit-btn" onclick="submitRoom()">ë°© ìƒì„±í•˜ê¸°</button>
    <button class="cancel-btn" onclick="closeCreate()">ì·¨ì†Œ</button>
  </div>
</div>

<!-- DETAIL MODAL -->
<div class="modal-overlay" id="detailModal">
  <div class="modal" id="detailContent"></div>
</div>

<!-- REVIEW MODAL -->
<div class="modal-overlay" id="reviewModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">â­ í›„ê¸° ì‘ì„±</div>
    <div style="background:var(--bg);border-radius:12px;padding:14px;margin-bottom:16px;display:flex;align-items:center;gap:10px">
      <span style="font-size:28px">ğŸ¥©</span>
      <div><div style="font-size:13px;font-weight:700">ì½”ìŠ¤íŠ¸ì½” LAê°ˆë¹„</div><div style="font-size:12px;color:var(--text-muted)">ë°©ì¥: ì„œìš¸ì‚´ì´_ë¯¼ì¤€ (92ì )</div></div>
    </div>
    <div class="form-group">
      <label class="form-label">ê±°ë˜ ë§Œì¡±ë„</label>
      <div class="star-row">
        <button class="star-btn" onclick="setStar(1)">â­</button>
        <button class="star-btn" onclick="setStar(2)">â­</button>
        <button class="star-btn" onclick="setStar(3)">â­</button>
        <button class="star-btn" onclick="setStar(4)">â­</button>
        <button class="star-btn" onclick="setStar(5)">â­</button>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">í•œ ì¤„ í›„ê¸°</label>
      <input class="form-input" id="reviewText" type="text" placeholder="ì˜ˆ) ì‹œê°„ë„ ì˜ ì§€í‚¤ê³  ìˆ˜ëŸ‰ë„ ë”± ë§ì•˜ì–´ìš”!">
    </div>
    <button class="submit-btn" onclick="submitReview()">í›„ê¸° ì œì¶œí•˜ê¸°</button>
    <button class="cancel-btn" onclick="closeReviewModal()">ì·¨ì†Œ</button>
  </div>
</div>

<!-- ì±„íŒ… ëª¨ë‹¬ -->
<div class="modal-overlay" id="chatModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="chat-header">
      <span id="chatEmoji" style="font-size:28px"></span>
      <div class="chat-room-info">
        <div class="chat-room-name" id="chatRoomName"></div>
        <div class="chat-room-sub" id="chatRoomSub"></div>
      </div>
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input-row">
      <input class="chat-input" id="chatInput" type="text" placeholder="ë©”ì‹œì§€ ì…ë ¥..." onkeydown="if(event.key==='Enter')sendChat()">
      <button class="chat-send-btn" onclick="sendChat()"><div class="toast" id="toast"></div>#10148;</button>
    </div>
    <button class="cancel-btn" onclick="closeChatModal()">ë‹«ê¸°</button>
  </div>
</div>

<!-- ì°¸ì—¬ì ëª©ë¡ ëª¨ë‹¬ -->
<div class="modal-overlay" id="participantModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title" id="participantTitle">ì°¸ì—¬ì ëª©ë¡</div>
    <div id="participantList"></div>
    <button class="cancel-btn" onclick="closeParticipantModal()">ë‹«ê¸°</button>
  </div>
</div>

<!-- ìˆ˜ë ¹ ì²´í¬ ëª¨ë‹¬ -->
<div class="modal-overlay" id="checkModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">ìˆ˜ë ¹ ì²´í¬</div>
    <div class="chat-header" style="margin-bottom:12px">
      <span id="checkEmoji" style="font-size:28px"></span>
      <div><div class="chat-room-name" id="checkRoomName"></div><div class="chat-room-sub" id="checkRoomSub"></div></div>
    </div>
    <div class="check-summary"><b id="checkProgress">0/0</b>ëª… ìˆ˜ë ¹ ì™„ë£Œ</div>
    <div id="checkList"></div>
    <button class="submit-btn" id="checkCompleteBtn" onclick="completeCheck()" style="margin-top:12px">ì™„ë£Œ ì²˜ë¦¬</button>
    <button class="cancel-btn" onclick="closeCheckModal()">ë‹«ê¸°</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const catEmojis = { ì‹í’ˆ:'ğŸ¥©', ìƒí™œ:'ğŸ§´', ìœ¡ì•„:'ğŸ¼', ë°˜ë ¤:'ğŸ¾', ê¸°íƒ€:'ğŸ“¦' };

const rooms = [
  { id:1, cat:'ì‹í’ˆ', emoji:'ğŸ¥©', name:'ì½”ìŠ¤íŠ¸ì½” LAê°ˆë¹„ 1+ë“±ê¸‰ (5kg ì„¸íŠ¸)', host:'ì„œìš¸ì‚´ì´_ë¯¼ì¤€', hostScore:92, total:5, filled:4.5, unit:'kg', price:65000, priceUnit:'kgë‹¹ 13,000ì›', deadline:'ì˜¤ëŠ˜ ì˜¤í›„ 6ì‹œ', place:'í™ˆí”ŒëŸ¬ìŠ¤ í•©ì •ì  ì•', joined:false, dist:'150m', participants:[{nick:'í•˜ëŠ˜ë¹›ì—¬í–‰ì',score:95},{nick:'ë§ˆí¬ì§‘ë°¥ëŸ¬',score:88},{nick:'ë‘ì•„ì´ì—„ë§ˆ',score:76},{nick:'ìš”ë¦¬í•˜ëŠ”ë‚¨ì',score:82}] },
  { id:2, cat:'ìœ¡ì•„', emoji:'ğŸ¼', name:'í•˜ê¸°ìŠ¤ ìš¸íŠ¸ë¼ ê¸°ì €ê·€ ë°•ìŠ¤ (1ë‹¨ê³„ 216ë§¤)', host:'ìŠˆí¼ë§˜_ì€ì •', hostScore:98, total:4, filled:2, unit:'ë°•ìŠ¤', price:28000, priceUnit:'ë°•ìŠ¤ë‹¹ 28,000ì›', deadline:'ì˜¤ëŠ˜ ì˜¤í›„ 8ì‹œ', place:'í•©ì •ì—­ 2ë²ˆ ì¶œêµ¬', joined:true, dist:'280m', participants:[{nick:'ì´ˆë³´ì•„ë¹ _ì¤€ì„œ',score:71},{nick:'ìœ¡ì•„ìŠ¤íƒ€ê·¸ë¨',score:89}] },
  { id:3, cat:'ë°˜ë ¤', emoji:'ğŸ¾', name:'ë¡œì–„ìºë‹Œ ì–´ëœíŠ¸ ì‚¬ë£Œ (15kg + ë¤)', host:'ê°•ì•„ì§€ë°”ë³´_í˜œì§„', hostScore:85, total:3, filled:3, unit:'í¬ëŒ€', price:42000, priceUnit:'í¬ëŒ€ë‹¹ 42,000ì›', deadline:'ë§ˆê°ë¨', place:'í•©ì • ì–´ìš¸ë§ˆë‹¹ ê³µì›', joined:false, dist:'500m', participants:[{nick:'ë©ë©ì´ì‚¬ë‘',score:91},{nick:'ëƒ¥ì´ì•„ë¹ ',score:78},{nick:'í„¸ë­‰ì¹˜ê°€ì¡±',score:83}] },
  { id:4, cat:'ìƒí™œ', emoji:'ğŸ§´', name:'ë‹¤ìš°ë‹ˆ í¼í”Œ ì„¬ìœ ìœ ì—°ì œ 5L ëŒ€ìš©ëŸ‰ 2ê°œ', host:'ì‚´ë¦¼ì™•_ì†Œì—°', hostScore:91, total:2, filled:0.5, unit:'ê°œ', price:18000, priceUnit:'ê°œë‹¹ 18,000ì›', deadline:'ë‚´ì¼ ì˜¤ì „ 11ì‹œ', place:'í•©ì •ë™ ì£¼ë¯¼ì„¼í„°', joined:false, dist:'420m', participants:[{nick:'ê¹”ë”í•œí•˜ë£¨',score:67}] }
];

const myTrades = {
  join: [
    { id:2, emoji:'ğŸ¼', name:'í•˜ê¸°ìŠ¤ ìš¸íŠ¸ë¼ ê¸°ì €ê·€ (1ë‹¨ê³„ 216ë§¤)', sub:'ì˜¤ëŠ˜ ì˜¤í›„ 8ì‹œ Â· í•©ì •ì—­ 2ë²ˆ ì¶œêµ¬', status:'active', statusText:'ì°¸ì—¬ ëŒ€ê¸°ì¤‘', needReview:false }
  ],
  host: [
    { id:5, emoji:'ğŸ§´', name:'í”¼ì£¤ ì„¬ìœ ìœ ì—°ì œ 5L (3ê°œ ë¶„ë°°)', sub:'ì–´ì œ ì™„ë£Œ Â· í•©ì •ë™ ì£¼ë¯¼ì„¼í„°', status:'wait', statusText:'ìˆ˜ë ¹ í™•ì¸ í•„ìš”' }
  ],
  done: [
    { id:6, emoji:'ğŸ¥©', name:'ì½”ìŠ¤íŠ¸ì½” LAê°ˆë¹„ (5kg)', sub:'2024.12.15 Â· í™ˆí”ŒëŸ¬ìŠ¤ í•©ì •ì ', stars:5, review:'ì‹œê°„ë„ ì˜ ì§€í‚¤ê³  ìˆ˜ëŸ‰ë„ ë”± ë§ì•˜ì–´ìš”! ë‹¤ìŒì— ë˜ ì°¸ì—¬í• ê²Œìš”.' },
    { id:7, emoji:'ğŸ¾', name:'ë¡œì–„ìºë‹Œ ì–´ëœíŠ¸ ì‚¬ë£Œ 15kg', sub:'2024.12.10 Â· í•©ì • ì–´ìš¸ë§ˆë‹¹ ê³µì›', stars:4, review:'ë¹ ë¥´ê³  ì¹œì ˆí–ˆì–´ìš” ğŸ‘' }
  ]
};

let catFilter = 'ì „ì²´';
let tradeTab = 'join';
let selectedStar = 0;
let reviewPending = true;

// NAV
function goNav(tab) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + tab).classList.add('active');
  document.getElementById('nav-' + tab).classList.add('active');
  document.getElementById('fabBtn').classList.toggle('hidden', tab === 'trade' || tab === 'my');
  if(tab === 'search') renderSearch('');
  if(tab === 'trade') { tradeTab = 'join'; switchTradeTab('join'); }
  window.scrollTo(0,0);
}

// HOME
function filterCat(btn, cat) {
  document.querySelectorAll('.cat-btn').forEach(x => x.classList.remove('active'));
  btn.classList.add('active');
  catFilter = cat;
  renderRooms();
}

function renderRooms() {
  const list = document.getElementById('roomList');
  const filtered = catFilter === 'ì „ì²´' ? rooms : rooms.filter(r => r.cat === catFilter);
  if(!filtered.length) {
    list.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“­</div><div class="empty-text">í•´ë‹¹ ì¹´í…Œê³ ë¦¬ ë°©ì´ ì—†ì–´ìš”</div><div class="empty-sub">ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ê±°ë‚˜ ë°©ì„ ì§ì ‘ ë§Œë“¤ì–´ë³´ì„¸ìš”!</div></div>`;
    return;
  }
  list.innerHTML = filtered.map(roomHTML).join('');
}

function roomHTML(r) {
  const pct = Math.min(100, (r.filled/r.total)*100);
  const isFull = r.filled >= r.total;
  const isDone = r.deadline === 'ë§ˆê°ë¨';
  return `<div class="room-card" onclick="openDetail(${r.id})">
    <div class="room-top">
      <div class="room-img">${r.emoji}</div>
      <div class="room-info">
        <div class="room-cat">${r.cat}</div>
        <div class="room-name">${r.name}</div>
        <div class="room-host">ë°©ì¥: ${r.host} <span class="host-score">${r.hostScore}ì </span></div>
        <div class="room-price">â‚©${r.price.toLocaleString()} <span>${r.priceUnit}</span></div>
      </div>
    </div>
    <div class="progress-area">
      <div class="progress-top"><span class="prog-label">ëª¨ì§‘ í˜„í™©</span><span class="prog-count ${isFull?'full':''}">${r.filled}/${r.total}${r.unit}${isFull?' âœ… ëª¨ì§‘ì™„ë£Œ':''}</span></div>
      <div class="progress-bg"><div class="progress-fill ${isFull?'full':''}" style="width:${pct}%"></div></div>
    </div>
    <div class="room-bottom">
      <div class="room-tags">
        <span class="tag tag-loc">ğŸ“ ${r.place}</span>
        <span class="tag tag-time">â° ${r.deadline}</span>
      </div>
      ${isDone||isFull
        ? `<button class="join-btn full-btn" onclick="event.stopPropagation()">ë§ˆê°</button>`
        : r.joined
        ? `<button class="join-btn joined" onclick="event.stopPropagation();toggleJoin(${r.id})">ì°¸ì—¬ì¤‘ âœ“</button>`
        : `<button class="join-btn" onclick="event.stopPropagation();toggleJoin(${r.id})">ì°¸ì—¬í•˜ê¸°</button>`}
    </div>
  </div>`;
}

function toggleJoin(id) {
  const r = rooms.find(x=>x.id===id);
  if(r.deadline==='ë§ˆê°ë¨'||r.filled>=r.total) return;
  r.joined = !r.joined;
  if(r.joined) {
    r.filled = Math.min(r.total, r.filled+0.5);
    myTrades.join.push({ id:r.id, emoji:r.emoji, name:r.name, sub:r.deadline+' Â· '+r.place, status:'active', statusText:'ì°¸ì—¬ ëŒ€ê¸°ì¤‘' });
    showToast('âœ… ì°¸ì—¬ ì‹ ì²­ ì™„ë£Œ! ì•½ì† ì‹œê°„ì— ê¼­ ë‚˜íƒ€ë‚˜ì£¼ì„¸ìš”.');
  } else {
    r.filled = Math.max(0, r.filled-0.5);
    myTrades.join = myTrades.join.filter(x=>x.id!==r.id);
    showToast('ì°¸ì—¬ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.');
  }
  updateNotice();
  renderRooms();
}

function updateNotice() {
  const cnt = rooms.filter(x=>x.filled<x.total&&x.deadline!=='ë§ˆê°ë¨').length;
  document.getElementById('locationNotice').textContent = `ì§€ê¸ˆ ${cnt}ê°œ ì§„í–‰ì¤‘`;
}

// DETAIL
function openDetail(id) {
  const r = rooms.find(x=>x.id===id);
  const pct = Math.min(100,(r.filled/r.total)*100);
  const isFull = r.filled>=r.total||r.deadline==='ë§ˆê°ë¨';
  document.getElementById('detailContent').innerHTML = `
    <div class="modal-handle"></div>
    <div class="detail-hero">${r.emoji}</div>
    <div class="detail-title">${r.name}</div>
    <div style="margin-bottom:16px">
      <div style="display:flex;justify-content:space-between;font-size:13px;margin-bottom:6px"><span style="color:var(--text-sub)">ëª¨ì§‘ í˜„í™©</span><span style="font-weight:700;color:${r.filled>=r.total?'var(--green)':'var(--primary)'}">${r.filled}/${r.total}${r.unit}</span></div>
      <div class="progress-bg"><div class="progress-fill ${r.filled>=r.total?'full':''}" style="width:${pct}%"></div></div>
    </div>
    <div class="detail-section">
      <div class="detail-sec-title">ê±°ë˜ ì •ë³´</div>
      <div class="detail-info-row"><span class="detail-info-label">ë°©ì¥</span><span class="detail-info-val">${r.host} (${r.hostScore}ì )</span></div>
      <div class="detail-info-row"><span class="detail-info-label">ì°¸ì—¬ ê°€ê²©</span><span class="detail-info-val" style="color:var(--primary)">â‚©${r.price.toLocaleString()}</span></div>
      <div class="detail-info-row"><span class="detail-info-label">ê±°ë˜ ì¥ì†Œ</span><span class="detail-info-val">ğŸ“ ${r.place}</span></div>
      <div class="detail-info-row"><span class="detail-info-label">ë§ˆê°</span><span class="detail-info-val">â° ${r.deadline}</span></div>
    </div>
    <div class="detail-section">
      <div class="detail-sec-title">ì°¸ì—¬ì (${r.participants.length}ëª…)</div>
      <div class="participants-list">${r.participants.map(p=>`<div class="participant-chip">${p.nick} <span class="p-score">${p.score}ì </span></div>`).join('')}</div>
    </div>
    <div class="detail-section">
      <div class="detail-sec-title">ì´ìš© ê·œì¹™</div>
      <div class="rule-list">
        <div class="rule-item"><span>âœ…</span>ê±°ë˜ ì™„ë£Œ í›„ í›„ê¸° ì‘ì„± í•„ìˆ˜. ë¯¸ì‘ì„± ì‹œ ì´ìš© ì œí•œ.</div>
        <div class="rule-item"><span>âš ï¸</span>ë…¸ì‡¼ ì‹œ ì‹ ë¢° ì ìˆ˜ í¬ê²Œ í•˜ë½, ì¬ì°¸ì—¬ ì œí•œë  ìˆ˜ ìˆìŒ.</div>
        <div class="rule-item"><span>ğŸ“</span>ì§€ì • ì¥ì†Œ ì™¸ ê°œì¸ ì¥ì†Œ ê±°ë˜ ë¶ˆê°€.</div>
      </div>
    </div>
    ${!isFull
      ? `<button class="submit-btn" onclick="toggleJoin(${r.id});closeDetail()">${r.joined?'ì°¸ì—¬ ì·¨ì†Œí•˜ê¸°':'ì´ ë°©ì— ì°¸ì—¬í•˜ê¸°'}</button>`
      : `<button class="submit-btn" style="background:var(--text-muted);cursor:default">ëª¨ì§‘ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤</button>`}
    <button class="cancel-btn" onclick="closeDetail()">ë‹«ê¸°</button>`;
  document.getElementById('detailModal').classList.add('open');
}
function closeDetail() { document.getElementById('detailModal').classList.remove('open'); }
document.getElementById('detailModal').addEventListener('click',e=>{if(e.target===document.getElementById('detailModal'))closeDetail();});

// SEARCH
function renderSearch(q) {
  const filtered = q ? rooms.filter(r=>r.name.includes(q)||r.cat.includes(q)) : rooms;
  document.getElementById('nearbyCount').textContent = filtered.length+'ê°œ';
  if(!filtered.length) {
    document.getElementById('searchResults').innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ”</div><div class="empty-text">"${q}" ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div><div class="empty-sub">ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”</div></div>`;
    return;
  }
  document.getElementById('searchResults').innerHTML = filtered.map(r=>`
    <div class="nearby-room" onclick="openDetail(${r.id})">
      <div class="nearby-emoji">${r.emoji}</div>
      <div style="flex:1">
        <div class="nearby-name">${r.name}</div>
        <div class="nearby-sub">â° ${r.deadline} Â· ë°©ì¥ ${r.hostScore}ì </div>
        <div class="nearby-sub">ğŸ“ ${r.place}</div>
      </div>
      <div style="text-align:right">
        <div class="nearby-dist">${r.dist}</div>
        <div style="font-size:11px;color:var(--text-muted);margin-top:2px">${r.filled}/${r.total}${r.unit}</div>
      </div>
    </div>`).join('');
}
function doSearch(v) { renderSearch(v); }
function searchKw(kw) { document.getElementById('searchInput').value=kw; renderSearch(kw); }

// TRADE
function switchTradeTab(tab) {
  tradeTab = tab;
  document.querySelectorAll('.trade-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('ttab-'+tab).classList.add('active');
  renderTrade();
}

function renderTrade() {
  const c = document.getElementById('tradeContent');
  const rp = document.getElementById('reviewPrompt');
  const data = myTrades[tradeTab];

  rp.style.display = (tradeTab==='join' && reviewPending && myTrades.done.length>0) ? 'flex' : 'none';

  if(!data.length) {
    const em = {join:{i:'ğŸ“‹',t:'ì°¸ì—¬ì¤‘ì¸ ê±°ë˜ê°€ ì—†ì–´ìš”',s:'í™ˆì—ì„œ ê³µë™êµ¬ë§¤ì— ì°¸ì—¬í•´ë³´ì„¸ìš”!'},host:{i:'ğŸ ',t:'ê°œì„¤í•œ ë°©ì´ ì—†ì–´ìš”',s:'ë°©ì„ ë§Œë“¤ì–´ ì´ì›ƒì„ ëª¨ì§‘í•´ë³´ì„¸ìš”!'},done:{i:'ğŸ‰',t:'ì™„ë£Œëœ ê±°ë˜ê°€ ì—†ì–´ìš”',s:'ì²« ê±°ë˜ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!'}};
    const e = em[tradeTab];
    c.innerHTML=`<div class="empty-state"><div class="empty-icon">${e.i}</div><div class="empty-text">${e.t}</div><div class="empty-sub">${e.s}</div></div>`;
    return;
  }

  if(tradeTab==='done') {
    c.innerHTML = data.map(t=>`
      <div class="history-card">
        <div class="history-item">
          <div class="trade-emoji">${t.emoji}</div>
          <div class="history-info">
            <div class="history-name">${t.name}</div>
            <div class="history-date">${t.sub}</div>
            <div class="history-stars">${'â­'.repeat(t.stars)}</div>
            <div class="history-review">"${t.review}"</div>
          </div>
        </div>
      </div>`).join('');
    return;
  }

  c.innerHTML = data.map(t=>`
    <div class="trade-card">
      <div class="trade-top">
        <div class="trade-emoji">${t.emoji}</div>
        <div class="trade-info"><div class="trade-name">${t.name}</div><div class="trade-sub">${t.sub}</div></div>
        <span class="status-badge status-${t.status}">${t.statusText}</span>
      </div>
      <div class="trade-actions">
        ${tradeTab==='join'
          ? `<button class="trade-btn trade-btn-secondary" onclick="openChatModal(${t.id})">ğŸ’¬ ì±„íŒ…</button>
             <button class="trade-btn trade-btn-primary" onclick="openDetail(${t.id})">ìƒì„¸ ë³´ê¸°</button>`
          : `<button class="trade-btn trade-btn-secondary" onclick="openParticipantModal(${t.id})">ğŸ‘¥ ì°¸ì—¬ì</button>
             <button class="trade-btn trade-btn-primary" onclick="openCheckModal(${t.id})">âœ… ìˆ˜ë ¹ ì²´í¬</button>`}
      </div>
    </div>`).join('');
}

// CREATE
function openCreate() { document.getElementById('createModal').classList.add('open'); }
function closeCreate() { document.getElementById('createModal').classList.remove('open'); }
document.getElementById('createModal').addEventListener('click',e=>{if(e.target===document.getElementById('createModal'))closeCreate();});

function selectPlace(el) {
  document.querySelectorAll('.place-opt').forEach(x=>x.classList.remove('selected'));
  el.classList.add('selected');
}

function submitRoom() {
  const name = document.getElementById('newName').value.trim();
  const cat = document.getElementById('newCat').value;
  const total = document.getElementById('newTotal').value.trim();
  const price = parseInt(document.getElementById('newPrice').value)||0;
  const sel = document.querySelector('.place-opt.selected');
  if(!name) { showToast('âš ï¸ ìƒí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”'); return; }
  if(!sel) { showToast('âš ï¸ ê±°ë˜ ì¥ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
  const place = sel.textContent.trim();
  const newR = { id:Date.now(), cat, emoji:catEmojis[cat]||'ğŸ“¦', name, host:'ë‹¹ê·¼ìœ ì €_ë§ˆí¬', hostScore:87, total:parseFloat(total)||3, filled:0, unit:'ê°œ', price, priceUnit:'ì°¸ì—¬ì í˜‘ì˜', deadline:'ì˜¤ëŠ˜ ì˜¤í›„ 9ì‹œ', place, joined:false, dist:'ë‚´ ë°©', participants:[] };
  rooms.unshift(newR);
  myTrades.host.unshift({ id:newR.id, emoji:newR.emoji, name, sub:'ì˜¤ëŠ˜ ì˜¤í›„ 9ì‹œ Â· '+place, status:'active', statusText:'ëª¨ì§‘ì¤‘' });
  closeCreate();
  renderRooms();
  updateNotice();
  showToast('ğŸ‰ ë°©ì´ ìƒì„±ëì–´ìš”! ì´ì›ƒë“¤ì—ê²Œ ì•Œë¦¼ì„ ë³´ëƒˆì–´ìš”.');
  document.getElementById('newName').value='';
  document.getElementById('newTotal').value='';
  document.getElementById('newPrice').value='';
  document.querySelectorAll('.place-opt').forEach(x=>x.classList.remove('selected'));
}

// REVIEW
function openReviewModal() { document.getElementById('reviewModal').classList.add('open'); selectedStar=0; updateStars(); }
function closeReviewModal() { document.getElementById('reviewModal').classList.remove('open'); }
document.getElementById('reviewModal').addEventListener('click',e=>{if(e.target===document.getElementById('reviewModal'))closeReviewModal();});

function setStar(n) { selectedStar=n; updateStars(); }
function updateStars() { document.querySelectorAll('.star-btn').forEach((b,i)=>b.classList.toggle('on',i<selectedStar)); }

function submitReview() {
  if(!selectedStar) { showToast('â­ ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”'); return; }
  const txt = document.getElementById('reviewText').value || 'ì¢‹ì€ ê±°ë˜ì˜€ì–´ìš”!';
  closeReviewModal();
  reviewPending = false;
  myTrades.done.unshift({ id:Date.now(), emoji:'ğŸ¥©', name:'ì½”ìŠ¤íŠ¸ì½” LAê°ˆë¹„ 5kg', sub:'ì˜¤ëŠ˜ Â· í™ˆí”ŒëŸ¬ìŠ¤ í•©ì •ì  ì•', stars:selectedStar, review:txt });
  document.getElementById('reviewPrompt').style.display='none';
  showToast('âœ… í›„ê¸° ì œì¶œ ì™„ë£Œ! ì‹ ë¢° ì ìˆ˜ +3ì ì´ ì˜¬ëì–´ìš”');
  if(tradeTab==='join') renderTrade();
}

// ===== ì±„íŒ… =====
const chatData = {
  2: {
    roomId:2, msgs:[
      { nick:'ìŠˆí¼ë§˜_ì€ì •', avatar:'ğŸ‘©', me:false, text:'ì•ˆë…•í•˜ì„¸ìš”! ë°©ì¥ì…ë‹ˆë‹¤. ì˜¤ëŠ˜ ì˜¤í›„ 8ì‹œì— í•©ì •ì—­ 2ë²ˆ ì¶œêµ¬ì—ì„œ ëµ™ê² ìŠµë‹ˆë‹¤ ğŸ˜Š', time:'ì˜¤í›„ 2:14' },
      { nick:'ë‚˜(ë‹¹ê·¼ìœ ì €_ë§ˆí¬)', avatar:'ğŸ¥•', me:true, text:'ë„¤! ê¸°ì €ê·€ 1ë°•ìŠ¤ ì‹ ì²­í–ˆì–´ìš”. í˜„ê¸ˆìœ¼ë¡œ ë“œë¦¬ë©´ ë ê¹Œìš”?', time:'ì˜¤í›„ 2:16' },
      { nick:'ìŠˆí¼ë§˜_ì€ì •', avatar:'ğŸ‘©', me:false, text:'ë„¤ í˜„ê¸ˆ ë˜ëŠ” ê³„ì¢Œì´ì²´ ëª¨ë‘ ê°€ëŠ¥í•´ìš”! 28,000ì›ì…ë‹ˆë‹¤ ğŸ‘', time:'ì˜¤í›„ 2:17' },
      { nick:'ì´ˆë³´ì•„ë¹ _ì¤€ì„œ', avatar:'ğŸ‘¨', me:false, text:'ì €ë„ 1ë°•ìŠ¤ì¸ë° í˜„ê¸ˆìœ¼ë¡œ ì¤€ë¹„í• ê²Œìš”!', time:'ì˜¤í›„ 3:01' },
    ]
  },
  5: {
    roomId:5, msgs:[
      { nick:'ë‚˜(ë‹¹ê·¼ìœ ì €_ë§ˆí¬)', avatar:'ğŸ¥•', me:true, text:'ë°© ìƒì„±í–ˆìŠµë‹ˆë‹¤! ëª¨ì§‘ ë§ˆê°ì€ ì˜¤ëŠ˜ ì˜¤í›„ 9ì‹œì…ë‹ˆë‹¤.', time:'ì˜¤í›„ 1:00' },
      { nick:'ê¹”ë”í•œí•˜ë£¨', avatar:'ğŸ§¹', me:false, text:'ì°¸ì—¬í–ˆì–´ìš”! 18,000ì› ì¤€ë¹„í• ê²Œìš”', time:'ì˜¤í›„ 1:30' },
    ]
  }
};

let currentChatId = null;

function openChatModal(id) {
  currentChatId = id;
  const r = rooms.find(x=>x.id===id) || { emoji:'ğŸ›’', name:'ê³µë™êµ¬ë§¤ ì±„íŒ…ë°©', place:'í•©ì •ì—­' };
  const t = myTrades.join.find(x=>x.id===id) || myTrades.host.find(x=>x.id===id) || {};
  document.getElementById('chatEmoji').textContent = r.emoji || t.emoji || 'ğŸ’¬';
  document.getElementById('chatRoomName').textContent = r.name || t.name || '';
  document.getElementById('chatRoomSub').textContent = r.place || '';
  if(!chatData[id]) chatData[id] = { roomId:id, msgs:[] };
  renderChatMessages();
  document.getElementById('chatModal').classList.add('open');
  setTimeout(()=>{ const cm=document.getElementById('chatMessages'); cm.scrollTop=cm.scrollHeight; }, 100);
}

function closeChatModal() { document.getElementById('chatModal').classList.remove('open'); }
document.getElementById('chatModal').addEventListener('click',e=>{ if(e.target===document.getElementById('chatModal')) closeChatModal(); });

function renderChatMessages() {
  const msgs = chatData[currentChatId]?.msgs || [];
  document.getElementById('chatMessages').innerHTML = msgs.map(m=>`
    <div class="chat-msg ${m.me?'me':''}">
      <div class="chat-avatar">${m.avatar}</div>
      <div class="chat-bubble-wrap">
        ${!m.me?`<div class="chat-nick">${m.nick}</div>`:''}
        <div class="chat-bubble">${m.text}</div>
        <div class="chat-time">${m.time}</div>
      </div>
    </div>`).join('');
  const cm = document.getElementById('chatMessages');
  cm.scrollTop = cm.scrollHeight;
}

function sendChat() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if(!text) return;
  const now = new Date();
  const h = now.getHours(); const m = String(now.getMinutes()).padStart(2,'0');
  const timeStr = `${h>=12?'ì˜¤í›„':'ì˜¤ì „'} ${h>12?h-12:h}:${m}`;
  if(!chatData[currentChatId]) chatData[currentChatId] = { roomId:currentChatId, msgs:[] };
  chatData[currentChatId].msgs.push({ nick:'ë‚˜(ë‹¹ê·¼ìœ ì €_ë§ˆí¬)', avatar:'ğŸ¥•', me:true, text, time:timeStr });
  input.value = '';
  renderChatMessages();
  // ìë™ ë‹µì¥ (1.2ì´ˆ í›„)
  const replies = ['ì•Œê² ìŠµë‹ˆë‹¤! ğŸ˜Š','ë„¤, í™•ì¸í–ˆì–´ìš”!','ì•½ì† ì‹œê°„ì— ëµê²Œìš” ğŸ‘‹','ê°ì‚¬í•©ë‹ˆë‹¤!'];
  setTimeout(()=>{
    chatData[currentChatId].msgs.push({ nick:'ìŠˆí¼ë§˜_ì€ì •', avatar:'ğŸ‘©', me:false, text:replies[Math.floor(Math.random()*replies.length)], time:timeStr });
    renderChatMessages();
  }, 1200);
}

// ===== ì°¸ì—¬ì ëª©ë¡ =====
const participantCheckState = {};

function openParticipantModal(id) {
  const r = rooms.find(x=>x.id===id);
  const t = myTrades.host.find(x=>x.id===id);
  const trade = t || {};
  const participants = r?.participants || [
    {nick:'ê¹”ë”í•œí•˜ë£¨', score:67, qty:'1ê°œ', avatar:'ğŸ§¹'},
    {nick:'ë§ˆí¬ì£¼ë¶€ì™•', score:81, qty:'1ê°œ', avatar:'ğŸ '},
  ];
  document.getElementById('participantTitle').textContent = `ğŸ‘¥ ì°¸ì—¬ì ëª©ë¡ (${participants.length}ëª…)`;
  document.getElementById('participantList').innerHTML = `
    <div style="background:var(--bg);border-radius:10px;padding:10px 14px;margin-bottom:12px;font-size:13px;display:flex;justify-content:space-between">
      <span style="color:var(--text-sub)">ìƒí’ˆëª…</span>
      <span style="font-weight:700">${r?.name || trade.name || 'ê³µë™êµ¬ë§¤'}</span>
    </div>
    <div style="background:var(--bg);border-radius:10px;padding:10px 14px;margin-bottom:16px;font-size:13px;display:flex;justify-content:space-between">
      <span style="color:var(--text-sub)">ê±°ë˜ ì¥ì†Œ</span>
      <span style="font-weight:700">ğŸ“ ${r?.place || 'í•©ì •ë™ ì£¼ë¯¼ì„¼í„°'}</span>
    </div>
    ${participants.map((p,i)=>`
    <div class="participant-row">
      <div class="participant-avatar">${p.avatar||'ğŸ‘¤'}</div>
      <div class="participant-info">
        <div class="participant-nick">${p.nick}</div>
        <div class="participant-detail">ì‹ ì²­ ìˆ˜ëŸ‰: ${p.qty||'1ê°œ'} Â· ì‹ ë¢°ì ìˆ˜ ${p.score}ì </div>
      </div>
      <span class="p-score-big">${p.score}ì </span>
    </div>`).join('')}
    <div style="margin-top:16px;padding:12px;background:var(--primary-pale);border-radius:10px;font-size:13px;color:var(--primary);font-weight:500">
      ğŸ’¡ ì°¸ì—¬ìì—ê²Œ ì±„íŒ…ìœ¼ë¡œ ê±°ë˜ ì¥ì†Œ ë° ì‹œê°„ì„ ì•ˆë‚´í•´ì£¼ì„¸ìš”.
    </div>`;
  document.getElementById('participantModal').classList.add('open');
}

function closeParticipantModal() { document.getElementById('participantModal').classList.remove('open'); }
document.getElementById('participantModal').addEventListener('click',e=>{ if(e.target===document.getElementById('participantModal')) closeParticipantModal(); });

// ===== ìˆ˜ë ¹ ì²´í¬ =====
const checkStates = {};

function openCheckModal(id) {
  const r = rooms.find(x=>x.id===id);
  const t = myTrades.host.find(x=>x.id===id);
  const trade = t || {};
  const participants = r?.participants?.length ? r.participants : [
    {nick:'ê¹”ë”í•œí•˜ë£¨', score:67, qty:'1ê°œ', avatar:'ğŸ§¹'},
    {nick:'ë§ˆí¬ì£¼ë¶€ì™•', score:81, qty:'1ê°œ', avatar:'ğŸ '},
  ];
  if(!checkStates[id]) checkStates[id] = participants.map((_,i)=>false);

  document.getElementById('checkEmoji').textContent = r?.emoji || trade.emoji || 'ğŸ“¦';
  document.getElementById('checkRoomName').textContent = r?.name || trade.name || 'ê³µë™êµ¬ë§¤';
  document.getElementById('checkRoomSub').textContent = `ğŸ“ ${r?.place || 'í•©ì •ë™ ì£¼ë¯¼ì„¼í„°'}`;

  renderCheckList(id, participants);
  document.getElementById('checkModal').classList.add('open');
}

function renderCheckList(id, participants) {
  const states = checkStates[id];
  const checkedCount = states.filter(Boolean).length;
  const total = states.length;
  document.getElementById('checkProgress').textContent = `${checkedCount}/${total}`;

  const btn = document.getElementById('checkCompleteBtn');
  if(checkedCount === total) {
    btn.style.background='var(--green)'; btn.style.cursor='pointer';
  } else {
    btn.style.background='var(--text-muted)'; btn.style.cursor='default';
  }

  document.getElementById('checkList').innerHTML = participants.map((p,i)=>`
    <div class="check-row ${states[i]?'checked':''}" id="checkRow${i}" onclick="toggleCheck('${id}',${i})">
      <div class="check-box">${states[i]?'âœ“':''}</div>
      <div class="check-info">
        <div class="check-name">${p.avatar||'ğŸ‘¤'} ${p.nick}</div>
        <div class="check-qty">ì‹ ì²­ ìˆ˜ëŸ‰: ${p.qty||'1ê°œ'} Â· ì‹ ë¢°ì ìˆ˜ ${p.score}ì </div>
      </div>
      <span class="check-status ${states[i]?'check-done':'check-wait'}">${states[i]?'ìˆ˜ë ¹ ì™„ë£Œ':'ë¯¸ìˆ˜ë ¹'}</span>
    </div>`).join('');
}

function toggleCheck(id, idx) {
  const r = rooms.find(x=>x.id==id);
  const participants = r?.participants?.length ? r.participants : [
    {nick:'ê¹”ë”í•œí•˜ë£¨', score:67, qty:'1ê°œ', avatar:'ğŸ§¹'},
    {nick:'ë§ˆí¬ì£¼ë¶€ì™•', score:81, qty:'1ê°œ', avatar:'ğŸ '},
  ];
  checkStates[id][idx] = !checkStates[id][idx];
  renderCheckList(id, participants);
}

function completeCheck() {
  // í˜„ì¬ ì—´ë¦° ì²´í¬ëª¨ë‹¬ì˜ id ì°¾ê¸°
  const id = Object.keys(checkStates).find(k => checkStates[k].every(Boolean));
  if(!id) { showToast('âš ï¸ ì•„ì§ ìˆ˜ë ¹í•˜ì§€ ì•Šì€ ì°¸ì—¬ìê°€ ìˆì–´ìš”'); return; }
  closeCheckModal();
  // ë°©ì¥ íƒ­ì—ì„œ ì™„ë£Œ ì²˜ë¦¬
  const idx = myTrades.host.findIndex(x=>x.id==id);
  if(idx>-1) {
    const t = myTrades.host[idx];
    myTrades.done.unshift({ id:t.id, emoji:t.emoji, name:t.name, sub:'ì˜¤ëŠ˜ ì™„ë£Œ Â· '+t.sub.split('Â·')[1], stars:5, review:'ë°©ì¥ìœ¼ë¡œì„œ ê±°ë˜ ì™„ë£Œ! ì°¸ì—¬ì ëª¨ë‘ ìˆ˜ë ¹ í™•ì¸ë¨.' });
    myTrades.host.splice(idx,1);
  }
  showToast('ğŸ‰ ê±°ë˜ ì™„ë£Œ! ì°¸ì—¬ìë“¤ì—ê²Œ í›„ê¸° ìš”ì²­ì„ ë³´ëƒˆì–´ìš”.');
  renderTrade();
}

function closeCheckModal() { document.getElementById('checkModal').classList.remove('open'); }
document.getElementById('checkModal').addEventListener('click',e=>{ if(e.target===document.getElementById('checkModal')) closeCheckModal(); });

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2500);
}

// INIT
renderRooms();
renderSearch('');
</script>
</body>
</html>
